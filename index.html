<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>普通话拼音挑战</title>
    <style>
        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
        }
        .btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
        }
        .btn:hover {
            background-color: #2980b9;
        }
        .option-btn {
            display: block;
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            background-color: #ecf0f1;
            border: 2px solid #bdc3c7;
            border-radius: 5px;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s;
        }
        .option-btn:hover {
            background-color: #d6eaf8;
            border-color: #3498db;
        }
        .option-btn.correct {
            background-color: #2ecc71;
            color: white;
            border-color: #27ae60;
        }
        .option-btn.wrong {
            background-color: #e74c3c;
            color: white;
            border-color: #c0392b;
        }
        #game-screen, #result-screen {
            display: none;
        }
        #word-display {
            font-size: 36px;
            text-align: center;
            margin: 30px 0;
            color: #2c3e50;
            font-weight: bold;
        }
        #score-display {
            text-align: center;
            font-size: 24px;
            margin: 20px 0;
            color: #3498db;
        }
        #progress-display {
            text-align: center;
            margin-bottom: 20px;
        }
        .difficulty-selector {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }
        .difficulty-btn {
            padding: 10px 20px;
            margin: 0 10px;
            background-color: #ecf0f1;
            border: 2px solid #bdc3c7;
            border-radius: 5px;
            cursor: pointer;
        }
        .difficulty-btn.selected {
            background-color: #3498db;
            color: white;
            border-color: #2980b9;
        }
        .count-selector {
            text-align: center;
            margin: 20px 0;
        }
        #word-count {
            width: 60px;
            padding: 5px;
            font-size: 16px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 开始屏幕 -->
        <div id="start-screen">
            <h1>普通话拼音挑战</h1>
            <p>请选择难度和测试词汇数量：</p>
            
            <div class="difficulty-selector">
                <div class="difficulty-btn" data-level="1">程度1</div>
                <div class="difficulty-btn" data-level="2">程度2</div>
                <div class="difficulty-btn" data-level="3">程度3</div>
            </div>
            
            <div class="count-selector">
                <label for="word-count">测试词汇数量：</label>
                <input type="number" id="word-count" min="5" max="50" value="10">
            </div>
            
            <button id="start-btn" class="btn">开始挑战</button>
        </div>
        
        <!-- 游戏屏幕 -->
        <div id="game-screen">
            <div id="progress-display">问题 1/<span id="total-questions">10</span></div>
            <div id="score-display">得分: 0</div>
            <div id="word-display">词汇</div>
            
            <div id="options-container">
                <!-- 选项将通过JavaScript动态生成 -->
            </div>
        </div>
        
        <!-- 结果屏幕 -->
        <div id="result-screen">
            <h1>测试完成!</h1>
            <div id="final-score" style="font-size: 24px; text-align: center; margin: 20px 0;"></div>
            <button id="restart-btn" class="btn">再试一次</button>
        </div>
    </div>

    <script>
        // 精选双字词汇数据库
        const vocabulary = [
            // 教育相关
            { word: "教育", pinyin: "jiào yù" },
            { word: "学校", pinyin: "xué xiào" },
            { word: "教师", pinyin: "jiào shī" },
            { word: "学生", pinyin: "xué shēng" },
            { word: "课程", pinyin: "kè chéng" },
            { word: "学习", pinyin: "xué xí" },
            { word: "教学", pinyin: "jiào xué" },
            { word: "考试", pinyin: "kǎo shì" },
            { word: "知识", pinyin: "zhī shi" },
            { word: "文化", pinyin: "wén huà" },
            
            // 社会相关
            { word: "社会", pinyin: "shè huì" },
            { word: "发展", pinyin: "fā zhǎn" },
            { word: "经济", pinyin: "jīng jì" },
            { word: "政策", pinyin: "zhèng cè" },
            { word: "法律", pinyin: "fǎ lǜ" },
            { word: "国际", pinyin: "guó jì" },
            { word: "政府", pinyin: "zhèng fǔ" },
            { word: "管理", pinyin: "guǎn lǐ" },
            { word: "资源", pinyin: "zī yuán" },
            { word: "环境", pinyin: "huán jìng" },
            
            // 学术相关
            { word: "研究", pinyin: "yán jiū" },
            { word: "科学", pinyin: "kē xué" },
            { word: "技术", pinyin: "jì shù" },
            { word: "理论", pinyin: "lǐ lùn" },
            { word: "实践", pinyin: "shí jiàn" },
            { word: "创新", pinyin: "chuàng xīn" },
            { word: "思维", pinyin: "sī wéi" },
            { word: "分析", pinyin: "fēn xī" },
            { word: "系统", pinyin: "xì tǒng" },
            { word: "方法", pinyin: "fāng fǎ" },
            
            // 品质相关
            { word: "品质", pinyin: "pǐn zhì" },
            { word: "能力", pinyin: "néng lì" },
            { word: "素质", pinyin: "sù zhì" },
            { word: "态度", pinyin: "tài du" },
            { word: "责任", pinyin: "zé rèn" },
            { word: "合作", pinyin: "hé zuò" },
            { word: "沟通", pinyin: "gōu tōng" },
            { word: "领导", pinyin: "lǐng dǎo" },
            { word: "团队", pinyin: "tuán duì" },
            { word: "效率", pinyin: "xiào lǜ" }
        ];

        // 相似拼音组 - 专门设计的迷惑选项
        const similarGroups = [
            // jiao yu 组
            {
                correct: "jiào yù",
                similars: ["jiāo yù", "jiǎo yú", "jiào yú", "jiāo yú"]
            },
            // xue xiao 组
            {
                correct: "xué xiào",
                similars: ["xuē xiāo", "xuè xiǎo", "xué xiǎo", "xuě xiào"]
            },
            // jiao shi 组
            {
                correct: "jiào shī",
                similars: ["jiāo shì", "jiǎo shí", "jiào shí", "jiāo shí"]
            },
            // xue sheng 组
            {
                correct: "xué shēng",
                similars: ["xuē shéng", "xuè shěng", "xué shěng", "xuě shēng"]
            },
            // ke cheng 组
            {
                correct: "kè chéng",
                similars: ["kē chèng", "kě chēng", "kè chēng", "kē chéng"]
            },
            // fa zhan 组
            {
                correct: "fā zhǎn",
                similars: ["fá zhàn", "fǎ zhān", "fā zhàn", "fà zhǎn"]
            },
            // jing ji 组
            {
                correct: "jīng jì",
                similars: ["jǐng jī", "jìng jí", "jīng jí", "jǐng jì"]
            },
            // zheng ce 组
            {
                correct: "zhèng cè",
                similars: ["zhēng cé", "zhěng cè", "zhèng cé", "zhēng cè"]
            },
            // guan li 组
            {
                correct: "guǎn lǐ",
                similars: ["guān lí", "guǎn lí", "guàn lǐ", "guān lǐ"]
            },
            // yan jiu 组
            {
                correct: "yán jiū",
                similars: ["yān jiù", "yǎn jiū", "yán jiù", "yàn jiū"]
            }
        ];

        // 游戏变量
        let currentQuestion = 0;
        let score = 0;
        let selectedDifficulty = 1;
        let totalQuestions = 10;
        let questions = [];
        
        // DOM元素
        const startScreen = document.getElementById('start-screen');
        const gameScreen = document.getElementById('game-screen');
        const resultScreen = document.getElementById('result-screen');
        const wordDisplay = document.getElementById('word-display');
        const optionsContainer = document.getElementById('options-container');
        const scoreDisplay = document.getElementById('score-display');
        const progressDisplay = document.getElementById('progress-display');
        const totalQuestionsDisplay = document.getElementById('total-questions');
        const finalScoreDisplay = document.getElementById('final-score');
        const wordCountInput = document.getElementById('word-count');
        const startBtn = document.getElementById('start-btn');
        const restartBtn = document.getElementById('restart-btn');
        
        // 难度选择
        document.querySelectorAll('.difficulty-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('selected'));
                this.classList.add('selected');
                selectedDifficulty = parseInt(this.getAttribute('data-level'));
            });
        });
        
        // 默认选择程度1
        document.querySelector('.difficulty-btn[data-level="1"]').classList.add('selected');
        
        // 开始游戏
        startBtn.addEventListener('click', startGame);
        
        // 重新开始
        restartBtn.addEventListener('click', function() {
            resultScreen.style.display = 'none';
            startScreen.style.display = 'block';
            score = 0;
            currentQuestion = 0;
        });
        
        // 开始游戏函数
        function startGame() {
            totalQuestions = parseInt(wordCountInput.value);
            if (totalQuestions < 5) totalQuestions = 5;
            if (totalQuestions > 50) totalQuestions = 50;
            
            // 根据难度准备问题
            prepareQuestions();
            
            startScreen.style.display = 'none';
            gameScreen.style.display = 'block';
            totalQuestionsDisplay.textContent = totalQuestions;
            
            showQuestion();
        }
        
        // 准备问题
        function prepareQuestions() {
            questions = [];
            
            // 随机选择词汇
            const shuffled = [...vocabulary].sort(() => 0.5 - Math.random());
            const selected = shuffled.slice(0, totalQuestions);
            
            // 为每个词汇生成问题和选项
            selected.forEach(item => {
                // 查找是否有预设的相似拼音组
                const similarGroup = similarGroups.find(group => group.correct === item.pinyin);
                
                let options;
                
                if (similarGroup) {
                    // 使用预设的相似拼音组
                    options = [item.pinyin, ...similarGroup.similars.slice(0, 3)];
                } else {
                    // 生成相似拼音选项
                    options = generateSimilarOptions(item.pinyin);
                }
                
                // 打乱选项顺序
                options = options.sort(() => 0.5 - Math.random());
                
                questions.push({
                    word: item.word,
                    correctPinyin: item.pinyin,
                    options: options
                });
            });
        }
        
        // 生成相似拼音选项
        function generateSimilarOptions(targetPinyin) {
            const options = [targetPinyin];
            const syllables = targetPinyin.split(' ');
            
            // 生成3个相似选项
            for (let i = 0; i < 3; i++) {
                let similarPinyin = '';
                
                // 对每个音节进行相似变换
                for (let j = 0; j < syllables.length; j++) {
                    similarPinyin += modifySyllable(syllables[j], i + 1) + ' ';
                }
                
                similarPinyin = similarPinyin.trim();
                options.push(similarPinyin);
            }
            
            return options;
        }
        
        // 修改音节生成相似拼音
        function modifySyllable(syllable, variation) {
            const initials = ['b','p','m','f','d','t','n','l','g','k','h','j','q','x','zh','ch','sh','r','z','c','s'];
            const finals = ['a','o','e','i','u','ü','ai','ei','ao','ou','an','en','ang','eng','ong',
                          'ia','ie','iao','iou','ian','in','iang','ing','iong',
                          'ua','uo','uai','uei','uan','uen','uang','ueng',
                          'üe','üan','ün'];
            const tones = ['1', '2', '3', '4', ''];
            
            // 提取原始音节的各部分
            const originalInitial = getInitial(syllable);
            const originalFinal = getFinal(syllable);
            const originalTone = getToneMark(syllable);
            
            let newInitial = originalInitial;
            let newFinal = originalFinal;
            let newTone = originalTone;
            
            // 根据variation决定修改哪部分
            switch(variation % 3) {
                case 1: // 修改声母
                    if (originalInitial) {
                        const similarInitials = initials.filter(i => 
                            i !== originalInitial && 
                            i.charAt(0) === originalInitial.charAt(0)
                        );
                        if (similarInitials.length > 0) {
                            newInitial = similarInitials[Math.floor(Math.random() * similarInitials.length)];
                        }
                    }
                    break;
                case 2: // 修改韵母
                    const similarFinals = finals.filter(f => 
                        f !== originalFinal && 
                        (f.charAt(0) === originalFinal.charAt(0) || 
                         f.slice(-1) === originalFinal.slice(-1))
                    );
                    if (similarFinals.length > 0) {
                        newFinal = similarFinals[Math.floor(Math.random() * similarFinals.length)];
                    }
                    break;
                case 0: // 修改声调
                    newTone = tones[Math.floor(Math.random() * tones.length)];
                    break;
            }
            
            // 组合新音节
            let newSyllable = newInitial + newFinal;
            
            // 添加声调标记
            if (newTone) {
                newSyllable = addToneMark(newSyllable, newTone);
            }
            
            return newSyllable;
        }
        
        // 获取音节的声母
        function getInitial(syllable) {
            if (!syllable) return '';
            
            // 处理 zh, ch, sh
            if (syllable.startsWith('zh')) return 'zh';
            if (syllable.startsWith('ch')) return 'ch';
            if (syllable.startsWith('sh')) return 'sh';
            
            // 处理其他声母
            const initial = syllable.charAt(0);
            if (['b','p','m','f','d','t','n','l','g','k','h','j','q','x','z','c','s','r','y','w'].includes(initial)) {
                return initial;
            }
            
            return '';
        }
        
        // 获取音节的韵母
        function getFinal(syllable) {
            if (!syllable) return '';
            
            // 去除声母部分
            let final = syllable;
            const initial = getInitial(syllable);
            if (initial) {
                final = syllable.substring(initial.length);
            }
            
            // 去除声调数字
            final = final.replace(/[1-5]/, '');
            
            return final;
        }
        
        // 获取音节的声调标记
        function getToneMark(syllable) {
            if (!syllable) return '';
            
            // 检查数字表示的声调
            const toneMatch = syllable.match(/[1-5]/);
            if (toneMatch) {
                return toneMatch[0];
            }
            
            // 根据拼音规则判断声调
            if (/[āēīōūǖ]/.test(syllable)) return '1';
            if (/[áéíóúǘ]/.test(syllable)) return '2';
            if (/[ǎěǐǒǔǚ]/.test(syllable)) return '3';
            if (/[àèìòùǜ]/.test(syllable)) return '4';
            
            return ''; // 轻声
        }
        
        // 为音节添加声调标记
        function addToneMark(syllable, tone) {
            const vowelMap = {
                'a': ['ā', 'á', 'ǎ', 'à'],
                'e': ['ē', 'é', 'ě', 'è'],
                'i': ['ī', 'í', 'ǐ', 'ì'],
                'o': ['ō', 'ó', 'ǒ', 'ò'],
                'u': ['ū', 'ú', 'ǔ', 'ù'],
                'ü': ['ǖ', 'ǘ', 'ǚ', 'ǜ']
            };
            
            const toneNum = parseInt(tone);
            if (isNaN(toneNum) || toneNum < 1 || toneNum > 4) {
                return syllable;
            }
            
            // 找到音节中的主要元音
            const vowels = ['a', 'e', 'o', 'i', 'u', 'ü'];
            let mainVowel = '';
            let mainVowelPos = -1;
            
            for (let i = 0; i < syllable.length; i++) {
                if (vowels.includes(syllable[i])) {
                    // 处理ü特殊情况
                    if (syllable[i] === 'u' && i > 0 && syllable[i-1] === 'y') {
                        mainVowel = 'ü';
                    } else {
                        mainVowel = syllable[i];
                    }
                    mainVowelPos = i;
                    break;
                }
            }
            
            if (!mainVowel || !vowelMap[mainVowel]) {
                return syllable + tone;
            }
            
            // 替换主要元音为带声调的形式
            const markedVowel = vowelMap[mainVowel][toneNum - 1];
            let newSyllable = syllable.substring(0, mainVowelPos) + 
                             markedVowel + 
                             syllable.substring(mainVowelPos + 1);
            
            return newSyllable;
        }
        
        // 显示问题
        function showQuestion() {
            if (currentQuestion >= questions.length) {
                // 游戏结束
                gameScreen.style.display = 'none';
                resultScreen.style.display = 'block';
                finalScoreDisplay.textContent = `你的得分: ${score}/${totalQuestions}`;
                return;
            }
            
            const question = questions[currentQuestion];
            wordDisplay.textContent = question.word;
            
            // 清空选项容器
            optionsContainer.innerHTML = '';
            
            // 创建选项按钮
            question.options.forEach((option, index) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = option;
                btn.addEventListener('click', function() {
                    checkAnswer(option, question.correctPinyin);
                });
                optionsContainer.appendChild(btn);
            });
            
            // 更新进度
            progressDisplay.textContent = `问题 ${currentQuestion + 1}/${totalQuestions}`;
        }
        
        // 检查答案
        function checkAnswer(selectedOption, correctAnswer) {
            const optionButtons = document.querySelectorAll('.option-btn');
            
            optionButtons.forEach(btn => {
                btn.disabled = true;
                if (btn.textContent === correctAnswer) {
                    btn.classList.add('correct');
                } else if (btn.textContent === selectedOption && selectedOption !== correctAnswer) {
                    btn.classList.add('wrong');
                }
            });
            
            if (selectedOption === correctAnswer) {
                score++;
                scoreDisplay.textContent = `得分: ${score}`;
            }
            
            // 延迟后进入下一题
            setTimeout(() => {
                currentQuestion++;
                showQuestion();
            }, 1500);
        }
    </script>
</body>
</html>
