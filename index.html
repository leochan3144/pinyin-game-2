<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
  <title>æ™®é€šè©±æ‹¼éŸ³é¸æ“‡éŠæˆ²</title>
  <style>
    body { font-family: "Microsoft JhengHei", sans-serif; padding: 20px; background: #f9f9f9; }
    h1 { color: #007acc; }
    button { font-size: 18px; padding: 10px 20px; margin: 5px 0; width: 100%; max-width: 400px; }
    .hidden { display: none; }
    .feedback { margin-top: 10px; font-weight: bold; }
    #next-btn { 
      background-color: #4CAF50;
      color: white;
      margin-top: 20px;
    }
  </style>
</head>
<body>
<h1>ğŸ® æ™®é€šè©±æ‹¼éŸ³é¸æ“‡éŠæˆ²</h1>

<div id="start-screen">
  <label>é¸æ“‡é¡Œæ•¸ï¼š
    <select id="question-count">
      <option value="5">5é¡Œ</option>
      <option value="10" selected>10é¡Œ</option>
      <option value="20">20é¡Œ</option>
    </select>
  </label>
  <br><br>
  <button onclick="startGame()">é–‹å§‹éŠæˆ²</button>
</div>

<div id="game-area" class="hidden">
  <h2 id="word-display"></h2>
  <button onclick="playPronunciation()">ğŸ”Š æ’­æ”¾ç™¼éŸ³</button>
  <div id="options"></div>
  <div class="feedback" id="feedback"></div>
  <p>å¾—åˆ†ï¼š<span id="score">0</span> ï¼ é¡Œè™Ÿï¼š<span id="current">1</span> / <span id="total"></span></p>
  <button id="next-btn" class="hidden" onclick="nextQuestion()">ä¸‹ä¸€é¡Œ</button>
</div>

<div id="end-screen" class="hidden">
  <h2>ğŸ‰ éŠæˆ²çµæŸï¼</h2>
  <p>ä½ çš„å¾—åˆ†æ˜¯ï¼š<span id="final-score"></span></p>
  <button onclick="location.reload()">å†ç©ä¸€æ¬¡</button>
</div>

<script>
const wordBank = [
  { word: "å­¸æ ¡", pinyin: "xuÃ© xiÃ o" },
  { word: "æ•™å®¤", pinyin: "jiÃ o shÃ¬" },
  { word: "èª²å®¤", pinyin: "kÃ¨ shÃ¬" },
  { word: "åœ–æ›¸é¤¨", pinyin: "tÃº shÅ« guÇn" },
  { word: "æ“å ´", pinyin: "cÄo chÇng" },
  { word: "ç¦®å ‚", pinyin: "lÇ tÃ¡ng" },
  { word: "é›»è…¦å®¤", pinyin: "diÃ n nÇo shÃ¬" },
  { word: "å¯¦é©—å®¤", pinyin: "shÃ­ yÃ n shÃ¬" },
  { word: "è¾¦å…¬å®¤", pinyin: "bÃ n gÅng shÃ¬" },
  { word: "èµ°å»Š", pinyin: "zÇ’u lÃ¡ng" },
  { word: "æ¨“æ¢¯", pinyin: "lÃ³u tÄ«" },
  { word: "å‡æ——å°", pinyin: "shÄ“ng qÃ­ tÃ¡i" },
  { word: "æ ¡é–€", pinyin: "xiÃ o mÃ©n" },
  { word: "é»‘æ¿", pinyin: "hÄ“i bÇn" },
  { word: "ç™½æ¿", pinyin: "bÃ¡i bÇn" },
  { word: "é˜è²", pinyin: "zhÅng shÄ“ng" },
  { word: "è¬›å°", pinyin: "jiÇng tÃ¡i" },
  { word: "èª²æ¡Œ", pinyin: "kÃ¨ zhuÅ" },
  { word: "æ¤…å­", pinyin: "yÇ zi" },
  { word: "ä¸Šèª²", pinyin: "shÃ ng kÃ¨" },
  { word: "ä¸‹èª²", pinyin: "xiÃ  kÃ¨" },
  { word: "ä½œæ¥­", pinyin: "zuÃ² yÃ¨" },
  { word: "è€ƒè©¦", pinyin: "kÇo shÃ¬" },
  { word: "æº«ç¿’", pinyin: "wÄ“n xÃ­" },
  { word: "é ç¿’", pinyin: "yÃ¹ xÃ­" },
  { word: "è¤‡ç¿’", pinyin: "fÃ¹ xÃ­" },
  { word: "å¯«å­—", pinyin: "xiÄ› zÃ¬" },
  { word: "é–±è®€", pinyin: "yuÃ¨ dÃº" },
  { word: "è½å¯«", pinyin: "tÄ«ng xiÄ›" },
  { word: "æœ—è®€", pinyin: "lÇng dÃº" },
  { word: "æ¼”è¬›", pinyin: "yÇn jiÇng" },
  { word: "å ±å‘Š", pinyin: "bÃ o gÃ o" },
  { word: "è©•ä¼°", pinyin: "pÃ­ng gÅ«" },
  { word: "æˆç¸¾", pinyin: "chÃ©ng jÄ«" },
  { word: "æ”¹å·", pinyin: "gÇi juÃ n" },
  { word: "ç­”æ¡ˆ", pinyin: "dÃ¡ Ã n" },
  { word: "å•é¡Œ", pinyin: "wÃ¨n tÃ­" },
  { word: "èªæ–‡", pinyin: "yÇ” wÃ©n" },
  { word: "è‹±æ–‡", pinyin: "yÄ«ng wÃ©n" },
  { word: "æ•¸å­¸", pinyin: "shÃ¹ xuÃ©" },
  { word: "å¸¸è­˜", pinyin: "chÃ¡ng shÃ­" },
  { word: "ç§‘å­¸", pinyin: "kÄ“ xuÃ©" },
  { word: "é›»è…¦", pinyin: "diÃ n nÇo" },
  { word: "éŸ³æ¨‚", pinyin: "yÄ«n yuÃ¨" },
  { word: "ç¾è¡“", pinyin: "mÄ›i shÃ¹" },
  { word: "é«”è‚²", pinyin: "tÇ yÃ¹" },
  { word: "å¥åº·æ•™è‚²", pinyin: "jiÃ n kÄng jiÃ o yÃ¹" },
  { word: "èª²æœ¬", pinyin: "kÃ¨ bÄ›n" },
  { word: "ä½œæ¥­æœ¬", pinyin: "zuÃ² yÃ¨ bÄ›n" },
  { word: "ç­†è¨˜æœ¬", pinyin: "bÇ jÃ¬ bÄ›n" },
  { word: "ç­†", pinyin: "bÇ" },
  { word: "é‰›ç­†", pinyin: "qiÄn bÇ" },
  { word: "æ©¡çš®æ“¦", pinyin: "xiÃ ng pÃ­ cÄ" },
  { word: "å°º", pinyin: "chÇ" },
  { word: "å‰ªåˆ€", pinyin: "jiÇn dÄo" },
  { word: "è† æ°´", pinyin: "jiÄo shuÇ" },
  { word: "æ–‡å…·ç›’", pinyin: "wÃ©n jÃ¹ hÃ©" },
  { word: "æ›¸åŒ…", pinyin: "shÅ« bÄo" },
  { word: "è¬›ç¾©", pinyin: "jiÇng yÃ¬" },
  { word: "è€ƒå·", pinyin: "kÇo juÃ n" },
  { word: "å½©è‰²ç­†", pinyin: "cÇi sÃ¨ bÇ" },
  { word: "ç™½ç´™", pinyin: "bÃ¡i zhÇ" },
  { word: "æ–‡ä»¶å¤¾", pinyin: "wÃ©n jiÃ n jiÃ¡" },
  { word: "è¨ˆç®—æ©Ÿ", pinyin: "jÃ¬ suÃ n jÄ«" },
  { word: "è€å¸«", pinyin: "lÇo shÄ«" },
  { word: "å­¸ç”Ÿ", pinyin: "xuÃ© sheng" },
  { word: "åŒå­¸", pinyin: "tÃ³ng xuÃ©" },
  { word: "æ ¡é•·", pinyin: "xiÃ o zhÇng" },
  { word: "å‰¯æ ¡é•·", pinyin: "fÃ¹ xiÃ o zhÇng" },
  { word: "åŠ©æ•™", pinyin: "zhÃ¹ jiÃ o" },
  { word: "å­¸é•·", pinyin: "xuÃ© zhÇng" },
  { word: "å­¸å¦¹", pinyin: "xuÃ© mÃ¨i" },
  { word: "ç­ä¸»ä»»", pinyin: "bÄn zhÇ” rÃ¨n" },
  { word: "å€¼æ—¥ç”Ÿ", pinyin: "zhÃ­ rÃ¬ shÄ“ng" },
  { word: "å®¶é•·", pinyin: "jiÄ zhÇng" },
  { word: "è¬›è€…", pinyin: "jiÇng zhÄ›" },
  { word: "ä»Šå¤©", pinyin: "jÄ«n tiÄn" },
  { word: "æ˜¨å¤©", pinyin: "zuÃ³ tiÄn" },
  { word: "æ˜å¤©", pinyin: "mÃ­ng tiÄn" },
  { word: "æ—©ä¸Š", pinyin: "zÇo shang" },
  { word: "ä¸­åˆ", pinyin: "zhÅng wÇ”" },
  { word: "æ™šä¸Š", pinyin: "wÇn shang" },
  { word: "ç¾åœ¨", pinyin: "xiÃ n zÃ i" },
  { word: "å‰›æ‰", pinyin: "gÄng cÃ¡i" },
  { word: "æ˜ŸæœŸ", pinyin: "xÄ«ng qÄ«" },
  { word: "æœˆä»½", pinyin: "yuÃ¨ fÃ¨n" },
  { word: "é»", pinyin: "diÇn" },
  { word: "åˆ†é˜", pinyin: "fÄ“n zhÅng" },
  { word: "é˜", pinyin: "zhÅng" },
  { word: "èª²è¡¨", pinyin: "kÃ¨ biÇo" },
  { word: "æ™‚é–“è¡¨", pinyin: "shÃ­ jiÄn biÇo" },
  { word: "ä¸‹èª²", pinyin: "xiÃ  kÃ¨" },
  { word: "ä¼‘æ¯", pinyin: "xiÅ« xi" },
  { word: "é€±æœ«", pinyin: "zhÅu mÃ²" },
  { word: "å‡æœŸ", pinyin: "jiÃ  qÄ«" },
  { word: "é–‹å­¸", pinyin: "kÄi xuÃ©" },
  { word: "æ”¾å‡", pinyin: "fÃ ng jiÃ " },
  { word: "èƒŒèª¦", pinyin: "bÃ¨i sÃ²ng" },
  { word: "è¨˜æ†¶", pinyin: "jÃ¬ yÃ¬" },
  { word: "ç†è§£", pinyin: "lÇ jiÄ›" },
  { word: "åˆ†æ", pinyin: "fÄ“n xÄ«" },
  { word: "æ•´ç†", pinyin: "zhÄ›ng lÇ" },
  { word: "å‰µä½œ", pinyin: "chuÃ ng zuÃ²" },
  { word: "ç·´ç¿’", pinyin: "liÃ n xÃ­" },
  { word: "æ¢ç©¶", pinyin: "tÃ n jiÅ«" },
  { word: "æ€è€ƒ", pinyin: "sÄ« kÇo" },
  { word: "ç™¼è¡¨", pinyin: "fÄ biÇo" },
  { word: "è¨è«–", pinyin: "tÇo lÃ¹n" },
  { word: "è§€å¯Ÿ", pinyin: "guÄn chÃ¡" },
  { word: "åæ€", pinyin: "fÇn sÄ«" },
  { word: "è¡¨ç¾", pinyin: "biÇo xiÃ n" },
  { word: "æ…‹åº¦", pinyin: "tÃ i dÃ¹" },
  { word: "é€²æ­¥", pinyin: "jÃ¬n bÃ¹" },
  { word: "çˆ¸çˆ¸", pinyin: "bÃ  ba" },
  { word: "åª½åª½", pinyin: "mÄ ma" },
  { word: "çˆºçˆº", pinyin: "yÃ© ye" },
  { word: "å¥¶å¥¶", pinyin: "nÇi nai" },
  { word: "å“¥å“¥", pinyin: "gÄ“ ge" },
  { word: "å§å§", pinyin: "jiÄ› jie" },
  { word: "å¼Ÿå¼Ÿ", pinyin: "dÃ¬ di" },
  { word: "å¦¹å¦¹", pinyin: "mÃ¨i mei" },
  { word: "æœ‹å‹", pinyin: "pÃ©ng you" },
  { word: "é„°å±…", pinyin: "lÃ­n jÅ«" },
  { word: "å¸æ©Ÿ", pinyin: "sÄ« jÄ«" },
  { word: "é†«ç”Ÿ", pinyin: "yÄ« shÄ“ng" },
  { word: "æœå‹™å“¡", pinyin: "fÃº wÃ¹ yuÃ¡n" },
  { word: "é¡§å®¢", pinyin: "gÃ¹ kÃ¨" },
  { word: "å…¬è»Š", pinyin: "gÅng chÄ“" },
  { word: "åœ°éµ", pinyin: "dÃ¬ tiÄ›" },
  { word: "è»Šç«™", pinyin: "chÄ“ zhÃ n" },
  { word: "ç«™ç‰Œ", pinyin: "zhÃ n pÃ¡i" },
  { word: "è·¯å£", pinyin: "lÃ¹ kÇ’u" },
  { word: "è½‰è»Š", pinyin: "zhuÇn chÄ“" },
  { word: "æ–¹å‘", pinyin: "fÄng xiÃ ng" },
  { word: "å‡ºå£", pinyin: "chÅ« kÇ’u" },
  { word: "å…¥å£", pinyin: "rÃ¹ kÇ’u" },
  { word: "å·¦è½‰", pinyin: "zuÇ’ zhuÇn" },
  { word: "å³è½‰", pinyin: "yÃ²u zhuÇn" },
  { word: "ç›´èµ°", pinyin: "zhÃ­ zÇ’u" },
  { word: "åœè»Šå ´", pinyin: "tÃ­ng chÄ“ chÇng" },
  { word: "å®¶", pinyin: "jiÄ" },
  { word: "è¶…å¸‚", pinyin: "chÄo shÃ¬" },
  { word: "é†«é™¢", pinyin: "yÄ« yuÃ n" },
  { word: "é¤å»³", pinyin: "cÄn tÄ«ng" },
  { word: "ç±³é£¯", pinyin: "mÇ fÃ n" },
  { word: "éºµæ¢", pinyin: "miÃ n tiÃ¡o" },
  { word: "åŒ…å­", pinyin: "bÄo zi" },
  { word: "é¤ƒå­", pinyin: "jiÇo zi" },
  { word: "æ¹¯", pinyin: "tÄng" },
  { word: "é­š", pinyin: "yÃº" },
  { word: "è‚‰", pinyin: "rÃ²u" },
  { word: "é’èœ", pinyin: "qÄ«ng cÃ i" },
  { word: "æ°´æœ", pinyin: "shuÇ guÇ’" },
  { word: "è˜‹æœ", pinyin: "pÃ­ng guÇ’" },
  { word: "é¦™è•‰", pinyin: "xiÄng jiÄo" },
  { word: "æœæ±", pinyin: "guÇ’ zhÄ«" },
  { word: "é£²æ–™", pinyin: "yÇn liÃ o" },
  { word: "ç‰›å¥¶", pinyin: "niÃº nÇi" },
  { word: "è›‹ç³•", pinyin: "dÃ n gÄo" },
  { word: "ç”Ÿç—…", pinyin: "shÄ“ng bÃ¬ng" },
  { word: "é ­ç—›", pinyin: "tÃ³u tÃ²ng" },
  { word: "ç™¼ç‡’", pinyin: "fÄ shÄo" },
  { word: "æ„Ÿå†’", pinyin: "gÇn mÃ o" },
  { word: "å’³å—½", pinyin: "kÃ© sou" },
  { word: "çœ‹é†«ç”Ÿ", pinyin: "kÃ n yÄ« shÄ“ng" },
  { word: "æ›è™Ÿ", pinyin: "guÃ  hÃ o" },
  { word: "åƒè—¥", pinyin: "chÄ« yÃ o" },
  { word: "é‡é«”æº«", pinyin: "liÃ¡ng tÇ wÄ“n" },
  { word: "æ‰“é‡", pinyin: "dÇ zhÄ“n" },
  { word: "ä¼‘æ¯", pinyin: "xiÅ« xi" },
  { word: "ä¾¿åˆ©åº—", pinyin: "biÃ n lÃ¬ diÃ n" },
  { word: "å•†å“", pinyin: "shÄng pÇn" },
  { word: "åƒ¹æ ¼", pinyin: "jiÃ  gÃ©" },
  { word: "æ‰“æŠ˜", pinyin: "dÇ zhÃ©" },
  { word: "ä¾¿å®œ", pinyin: "piÃ¡n yi" },
  { word: "è²´", pinyin: "guÃ¬" },
  { word: "ç¾é‡‘", pinyin: "xiÃ n jÄ«n" },
  { word: "ä¿¡ç”¨å¡", pinyin: "xÃ¬n yÃ²ng kÇ" },
  { word: "ä»˜æ¬¾", pinyin: "fÃ¹ kuÇn" },
  { word: "æ‰¾éŒ¢", pinyin: "zhÇo qiÃ¡n" },
  { word: "æ”¶æ“š", pinyin: "shÅu jÃ¹" },
  { word: "ç™¼ç¥¨", pinyin: "fÄ piÃ o" },
  { word: "è²·ä¸€é€ä¸€", pinyin: "mÇi yÄ« sÃ²ng yÄ«" },
  { word: "å…è²»è©¦ç”¨", pinyin: "miÇn fÃ¨i shÃ¬ yÃ²ng" }
];

const confusables = {
  "initials": {
    "zh": [
      "z",
      "ch"
    ],
    "ch": [
      "zh",
      "q"
    ],
    "sh": [
      "s",
      "x"
    ],
    "z": [
      "zh",
      "j"
    ],
    "c": [
      "ch",
      "q"
    ],
    "s": [
      "sh",
      "x"
    ],
    "j": [
      "z",
      "q"
    ],
    "q": [
      "c",
      "ch"
    ],
    "x": [
      "sh",
      "s"
    ],
    "b": [
      "p",
      "d"
    ],
    "d": [
      "b",
      "t"
    ],
    "t": [
      "d",
      "k"
    ],
    "g": [
      "k",
      "h"
    ],
    "k": [
      "g",
      "t"
    ],
    "h": [
      "k",
      "x"
    ]
  },
  "finals": {
    "ang": [
      "an",
      "eng"
    ],
    "eng": [
      "ang",
      "en"
    ],
    "ing": [
      "in",
      "iang"
    ],
    "in": [
      "ing",
      "ian"
    ],
    "ian": [
      "in",
      "iang"
    ],
    "iang": [
      "ian",
      "ing"
    ],
    "ao": [
      "ou",
      "an"
    ],
    "ou": [
      "ao",
      "o"
    ],
    "an": [
      "ang",
      "en"
    ],
    "en": [
      "eng",
      "an"
    ],
    "ong": [
      "eng",
      "uang"
    ]
  }
};

let questions = [];
let current = 0, score = 0, total = 0;

function startGame() {
  total = parseInt(document.getElementById("question-count").value);
  questions = shuffleArray(wordBank).slice(0, total);
  document.getElementById("start-screen").classList.add("hidden");
  document.getElementById("game-area").classList.remove("hidden");
  document.getElementById("total").textContent = total;
  showQuestion();
}

function showQuestion() {
  let item = questions[current];
  document.getElementById("word-display").textContent = item.word;
  document.getElementById("feedback").textContent = "";
  document.getElementById("current").textContent = current + 1;
  document.getElementById("next-btn").classList.add("hidden");

  let correct = item.pinyin;
  let options = generateConfusableOptions(correct);
  options = shuffleArray([correct, ...options.slice(0, 3)]);

  let container = document.getElementById("options");
  container.innerHTML = "";
  options.forEach(p => {
    let btn = document.createElement("button");
    btn.textContent = p;
    btn.onclick = () => checkAnswer(p, correct);
    container.appendChild(btn);
  });
}

function checkAnswer(selected, correct) {
  let fb = document.getElementById("feedback");
  if (selected === correct) {
    score++;
    fb.textContent = "âœ… æ­£ç¢ºï¼";
  } else {
    fb.textContent = `âŒ éŒ¯äº†ï¼Œæ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š${correct}`;
  }
  document.getElementById("score").textContent = score;

  // ç¦ç”¨æ‰€æœ‰é¸é …æŒ‰éˆ•
  document.querySelectorAll("#options button").forEach(btn => {
    btn.disabled = true;
  });
  
  // é¡¯ç¤ºã€Œä¸‹ä¸€é¡Œã€æŒ‰éˆ•
  document.getElementById("next-btn").classList.remove("hidden");
}

function nextQuestion() {
  // å•Ÿç”¨æ‰€æœ‰é¸é …æŒ‰éˆ•
  document.querySelectorAll("#options button").forEach(btn => {
    btn.disabled = false;
  });
  
  current++;
  if (current < total) {
    showQuestion();
  } else {
    endGame();
  }
}

function endGame() {
  document.getElementById("game-area").classList.add("hidden");
  document.getElementById("end-screen").classList.remove("hidden");
  document.getElementById("final-score").textContent = `${score} / ${total}`;
}

function playPronunciation() {
  let word = questions[current].word;
  let utter = new SpeechSynthesisUtterance(word);
  utter.lang = "zh-CN";
  speechSynthesis.speak(utter);
}

function shuffleArray(arr) {
  return arr.sort(() => Math.random() - 0.5);
}

function generateConfusableOptions(correct) {
  const tones = {
    'a': ['Ä','Ã¡','Ç','Ã '],
    'e': ['Ä“','Ã©','Ä›','Ã¨'],
    'i': ['Ä«','Ã­','Ç','Ã¬'],
    'o': ['Å','Ã³','Ç’','Ã²'],
    'u': ['Å«','Ãº','Ç”','Ã¹'],
    'Ã¼': ['Ç–','Ç˜','Çš','Çœ']
  };
  const toneMap = {
    'Ä':'a','Ã¡':'a','Ç':'a','Ã ':'a',
    'Ä“':'e','Ã©':'e','Ä›':'e','Ã¨':'e',
    'Ä«':'i','Ã­':'i','Ç':'i','Ã¬':'i',
    'Å':'o','Ã³':'o','Ç’':'o','Ã²':'o',
    'Å«':'u','Ãº':'u','Ç”':'u','Ã¹':'u',
    'Ç–':'Ã¼','Ç˜':'Ã¼','Çš':'Ã¼','Çœ':'Ã¼'
  };
  const removeTone = (pinyin) => pinyin.split('').map(c => toneMap[c] || c).join('');
  const applyTone = (syl) => {
    for (let v in tones) {
      if (syl.includes(v)) {
        return syl.replace(v, tones[v][Math.floor(Math.random()*4)]);
      }
    }
    return syl;
  };

  let noToneParts = removeTone(correct).split(" ");
  let variations = new Set();

  while (variations.size < 10) {
    let variation = noToneParts.map(syl => {
      let init = Object.keys(confusables.initials).find(i => syl.startsWith(i));
      let fin = Object.keys(confusables.finals).find(f => syl.endsWith(f));
      let newSyl = syl;
      if (init && confusables.initials[init]) {
        let newInit = confusables.initials[init][Math.floor(Math.random() * confusables.initials[init].length)];
        newSyl = newSyl.replace(init, newInit);
      }
      if (fin && confusables.finals[fin]) {
        let newFin = confusables.finals[fin][Math.floor(Math.random() * confusables.finals[fin].length)];
        newSyl = newSyl.replace(fin, newFin);
      }
      return applyTone(newSyl);
    }).join(" ");
    if (variation !== correct) variations.add(variation);
  }

  return Array.from(variations);
}
</script>
</body>
</html>
