<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>普通話拼音遊戲</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                    }
                }
            },
            darkMode: 'class'
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
        }
        
        .choice-btn {
            transition: all 0.2s ease;
        }
        
        .choice-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(93, 92, 222, 0.3);
        }
        
        .correct {
            background-color: #10B981 !important;
            border-color: #10B981 !important;
            color: white !important;
        }
        
        .incorrect {
            background-color: #EF4444 !important;
            border-color: #EF4444 !important;
            color: white !important;
        }
        
        .disabled {
            pointer-events: none;
            opacity: 0.6;
        }
    </style>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-white min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-2xl">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-primary mb-2">普通話拼音遊戲</h1>
            <p class="text-gray-600 dark:text-gray-300">學校交流團 × 旅遊場景</p>
        </div>

        <!-- Score and Progress -->
        <div class="bg-gray-50 dark:bg-gray-800 rounded-lg p-4 mb-6 flex justify-between items-center">
            <div class="text-sm">
                <span class="text-gray-600 dark:text-gray-300">分數：</span>
                <span id="score" class="font-semibold text-primary">0</span>
            </div>
            <div class="text-sm">
                <span class="text-gray-600 dark:text-gray-300">題目：</span>
                <span id="questionCount" class="font-semibold">1</span>
            </div>
            <div class="text-sm">
                <span class="text-gray-600 dark:text-gray-300">正確率：</span>
                <span id="accuracy" class="font-semibold text-green-600">0%</span>
            </div>
        </div>

        <!-- Game Area -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-8 mb-6">
            <!-- Chinese Word Display -->
            <div class="text-center mb-8">
                <div class="text-6xl font-bold text-primary mb-4" id="chineseWord">載入中...</div>
                <div class="text-sm text-gray-500 dark:text-gray-400" id="wordMeaning"></div>
            </div>

            <!-- Multiple Choice Options -->
            <div class="grid grid-cols-1 gap-3 mb-6" id="choicesContainer">
                <!-- Choices will be generated by JavaScript -->
            </div>

            <!-- Feedback Area -->
            <div id="feedback" class="text-center text-sm min-h-[24px] mb-4"></div>

            <!-- Next Button -->
            <div class="text-center">
                <button id="nextBtn" 
                        class="bg-primary hover:bg-blue-600 text-white px-6 py-2 rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                        disabled>
                    下一題
                </button>
            </div>
        </div>

        <!-- Instructions -->
        <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 text-sm">
            <h3 class="font-semibold text-blue-800 dark:text-blue-200 mb-2">遊戲說明</h3>
            <ul class="text-blue-700 dark:text-blue-300 space-y-1">
                <li>• 看中文詞語，選擇正確的拼音</li>
                <li>• 詞彙來源：學校交流團和旅遊場景</li>
                <li>• 注意聲調符號的正確性</li>
            </ul>
        </div>
    </div>

    <script>
        // Dark mode detection
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // Word database with Chinese words, pinyin, and meanings
        const wordDatabase = [
            // School Exchange
            { word: "學校", pinyin: "xuéxiào", meaning: "教育機構" },
            { word: "交流", pinyin: "jiāoliú", meaning: "互相學習" },
            { word: "學生", pinyin: "xuéshēng", meaning: "在校學習的人" },
            { word: "老師", pinyin: "lǎoshī", meaning: "教書的人" },
            { word: "課程", pinyin: "kèchéng", meaning: "教學內容" },
            { word: "宿舍", pinyin: "sùshè", meaning: "學生住宿的地方" },
            { word: "圖書館", pinyin: "túshūguǎn", meaning: "藏書和閱讀的地方" },
            { word: "教室", pinyin: "jiàoshì", meaning: "上課的房間" },
            { word: "考試", pinyin: "kǎoshì", meaning: "測驗學習成果" },
            { word: "作業", pinyin: "zuòyè", meaning: "課後練習" },
            { word: "同學", pinyin: "tóngxué", meaning: "一起學習的人" },
            { word: "校園", pinyin: "xiàoyuán", meaning: "學校的範圍" },
            { word: "食堂", pinyin: "shítáng", meaning: "學校餐廳" },
            { word: "實習", pinyin: "shíxí", meaning: "實際練習" },
            { word: "畢業", pinyin: "bìyè", meaning: "完成學業" },
            
            // Travel
            { word: "旅遊", pinyin: "lǚyóu", meaning: "外出遊玩" },
            { word: "機場", pinyin: "jīchǎng", meaning: "飛機起降的地方" },
            { word: "飯店", pinyin: "fàndiàn", meaning: "提供住宿的地方" },
            { word: "餐廳", pinyin: "cāntīng", meaning: "用餐的地方" },
            { word: "博物館", pinyin: "bówùguǎn", meaning: "展示文物的地方" },
            { word: "景點", pinyin: "jǐngdiǎn", meaning: "風景名勝" },
            { word: "地鐵", pinyin: "dìtiě", meaning: "地下鐵路" },
            { word: "公車", pinyin: "gōngchē", meaning: "公共汽車" },
            { word: "購物", pinyin: "gòuwù", meaning: "買東西" },
            { word: "導遊", pinyin: "dǎoyóu", meaning: "帶領旅遊的人" },
            { word: "護照", pinyin: "hùzhào", meaning: "出國身份證明" },
            { word: "簽證", pinyin: "qiānzhèng", meaning: "入境許可" },
            { word: "行李", pinyin: "xínglǐ", meaning: "旅行時攜帶的物品" },
            { word: "車站", pinyin: "chēzhàn", meaning: "車輛停靠的地方" },
            { word: "計程車", pinyin: "jìchéngchē", meaning: "按距離收費的車" },
            { word: "觀光", pinyin: "guānguāng", meaning: "遊覽參觀" },
            { word: "紀念品", pinyin: "jìniànpǐn", meaning: "留作紀念的物品" },
            { word: "風景", pinyin: "fēngjǐng", meaning: "自然景色" },
            { word: "文化", pinyin: "wénhuà", meaning: "人類文明成果" },
            { word: "傳統", pinyin: "chuántǒng", meaning: "世代相傳的習俗" }
        ];

        let currentWord = {};
        let choices = [];
        let score = 0;
        let questionCount = 0;
        let correctAnswers = 0;

        // Generate similar pinyin options
        function generateWrongPinyin(correctPinyin) {
            const toneMarks = {
                'ā': ['á', 'ǎ', 'à', 'a'],
                'á': ['ā', 'ǎ', 'à', 'a'],
                'ǎ': ['ā', 'á', 'à', 'a'],
                'à': ['ā', 'á', 'ǎ', 'a'],
                'ē': ['é', 'ě', 'è', 'e'],
                'é': ['ē', 'ě', 'è', 'e'],
                'ě': ['ē', 'é', 'è', 'e'],
                'è': ['ē', 'é', 'ě', 'e'],
                'ī': ['í', 'ǐ', 'ì', 'i'],
                'í': ['ī', 'ǐ', 'ì', 'i'],
                'ǐ': ['ī', 'í', 'ì', 'i'],
                'ì': ['ī', 'í', 'ǐ', 'i'],
                'ō': ['ó', 'ǒ', 'ò', 'o'],
                'ó': ['ō', 'ǒ', 'ò', 'o'],
                'ǒ': ['ō', 'ó', 'ò', 'o'],
                'ò': ['ō', 'ó', 'ǒ', 'o'],
                'ū': ['ú', 'ǔ', 'ù', 'u'],
                'ú': ['ū', 'ǔ', 'ù', 'u'],
                'ǔ': ['ū', 'ú', 'ù', 'u'],
                'ù': ['ū', 'ú', 'ǔ', 'u'],
                'ü': ['ǘ', 'ǚ', 'ǜ', 'v'],
                'ǘ': ['ü', 'ǚ', 'ǜ', 'v'],
                'ǚ': ['ü', 'ǘ', 'ǜ', 'v'],
                'ǜ': ['ü', 'ǘ', 'ǚ', 'v']
            };

            const similarConsonants = {
                'b': ['p', 'd'],
                'p': ['b', 't'],
                'd': ['t', 'b'],
                't': ['d', 'p'],
                'g': ['k'],
                'k': ['g'],
                'j': ['zh', 'z'],
                'q': ['ch', 'c'],
                'x': ['sh', 's'],
                'z': ['j', 'zh'],
                'c': ['q', 'ch'],
                's': ['x', 'sh'],
                'zh': ['j', 'z'],
                'ch': ['q', 'c'],
                'sh': ['x', 's'],
                'l': ['n'],
                'n': ['l'],
                'r': ['l']
            };

            let wrongOptions = [];

            // Generate tone variations
            for (let char of correctPinyin) {
                if (toneMarks[char]) {
                    let variations = toneMarks[char];
                    for (let variation of variations) {
                        let wrongPinyin = correctPinyin.replace(char, variation);
                        if (wrongPinyin !== correctPinyin) {
                            wrongOptions.push(wrongPinyin);
                        }
                    }
                }
            }

            // Generate consonant variations
            for (let consonant in similarConsonants) {
                if (correctPinyin.includes(consonant)) {
                    for (let similar of similarConsonants[consonant]) {
                        let wrongPinyin = correctPinyin.replace(consonant, similar);
                        if (wrongPinyin !== correctPinyin) {
                            wrongOptions.push(wrongPinyin);
                        }
                    }
                }
            }

            // Shuffle and return unique options
            wrongOptions = [...new Set(wrongOptions)];
            return wrongOptions.sort(() => Math.random() - 0.5);
        }

        function generateNewQuestion() {
            // Select random word
            currentWord = wordDatabase[Math.floor(Math.random() * wordDatabase.length)];
            
            // Generate wrong options
            let wrongPinyins = generateWrongPinyin(currentWord.pinyin);
            
            // Create choices array with correct answer and 3 wrong options
            choices = [currentWord.pinyin];
            while (choices.length < 4 && wrongPinyins.length > 0) {
                choices.push(wrongPinyins.pop());
            }
            
            // If not enough variations, add some common wrong patterns
            while (choices.length < 4) {
                choices.push(currentWord.pinyin.replace(/[āáǎàēéěèīíǐìōóǒòūúǔùüǘǚǜ]/g, 'a'));
            }
            
            // Shuffle choices
            choices = choices.sort(() => Math.random() - 0.5);
            
            // Update UI
            questionCount++;
            updateDisplay();
        }

        function updateDisplay() {
            document.getElementById('chineseWord').textContent = currentWord.word;
            document.getElementById('wordMeaning').textContent = currentWord.meaning;
            document.getElementById('questionCount').textContent = questionCount;
            document.getElementById('score').textContent = score;
            document.getElementById('accuracy').textContent = 
                questionCount > 1 ? Math.round((correctAnswers / (questionCount - 1)) * 100) + '%' : '0%';
            
            // Clear feedback
            document.getElementById('feedback').textContent = '';
            document.getElementById('nextBtn').disabled = true;
            
            // Generate choice buttons
            const container = document.getElementById('choicesContainer');
            container.innerHTML = '';
            
            choices.forEach((choice, index) => {
                const button = document.createElement('button');
                button.className = 'choice-btn bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 border-2 border-gray-200 dark:border-gray-600 rounded-lg p-4 text-left font-medium text-lg transition-all';
                button.textContent = choice;
                button.onclick = () => selectAnswer(choice, button);
                container.appendChild(button);
            });
        }

        function selectAnswer(selectedPinyin, buttonElement) {
            const isCorrect = selectedPinyin === currentWord.pinyin;
            const buttons = document.querySelectorAll('.choice-btn');
            
            // Disable all buttons
            buttons.forEach(btn => btn.classList.add('disabled'));
            
            // Mark correct and incorrect answers
            buttons.forEach(btn => {
                if (btn.textContent === currentWord.pinyin) {
                    btn.classList.add('correct');
                } else if (btn === buttonElement && !isCorrect) {
                    btn.classList.add('incorrect');
                }
            });
            
            // Update score and feedback
            if (isCorrect) {
                score += 10;
                correctAnswers++;
                document.getElementById('feedback').innerHTML = 
                    '<span class="text-green-600 font-semibold">✓ 正確！很棒！</span>';
            } else {
                document.getElementById('feedback').innerHTML = 
                    `<span class="text-red-600 font-semibold">✗ 錯誤！正確答案是：${currentWord.pinyin}</span>`;
            }
            
            // Enable next button
            document.getElementById('nextBtn').disabled = false;
        }

        function nextQuestion() {
            generateNewQuestion();
        }

        // Event listeners
        document.getElementById('nextBtn').addEventListener('click', nextQuestion);

        // Initialize game
        generateNewQuestion();
    </script>
</body>
</html>
